<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Number Roller (pure HTML/CSS/JS)</title>
<style>
  :root {
    --digit-height: 1.6em;
    --digit-width: 0.8em;
    --duration: 700ms;
    --easing: cubic-bezier(.2,.7,0,1);
    --gap: .25rem;
    --fg: #111;
    --muted: #6b7280;
    --accent: #0ea5e9;
  }

  body {
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Noto Sans";
    color: var(--fg);
    margin: 0;
    padding: 24px;
    background: #f8fafc;
  }

  .app {
    max-width: 860px;
    margin: 0 auto;
    display: grid;
    gap: 20px;
  }

  .controls {
    display: grid;
    grid-template-columns: 1fr 1fr auto;
    gap: 12px;
    align-items: end;
  }

  .field {
    display: grid;
    gap: 6px;
  }

  label {
    font-size: 12px;
    color: var(--muted);
  }

  input[type="text"] {
    height: 40px;
    border: 1px solid #e5e7eb;
    outline: none;
    border-radius: 8px;
    padding: 0 12px;
    background: #fff;
    font-size: 14px;
  }
  input[type="text"]:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(14,165,233,.15);
  }

  button {
    height: 40px;
    border-radius: 8px;
    border: none;
    padding: 0 16px;
    background: var(--accent);
    color: white;
    font-weight: 600;
    cursor: pointer;
  }
  button:active { transform: translateY(1px) }

  .card {
    background: #fff;
    border: 1px solid #e5e7eb;
    border-radius: 14px;
    padding: 18px 20px;
    box-shadow: 0 1px 0 rgba(0,0,0,0.02);
  }

  .label {
    font-size: 12px;
    color: var(--muted);
    margin-bottom: 6px;
  }

  .roller {
    display: inline-flex;
    align-items: baseline;
    gap: 0;
    font-weight: 700;
    font-size: 32px;
    line-height: 1.1;
    font-variant-numeric: tabular-nums;
    letter-spacing: .02em;
    white-space: pre;
  }

  .roller .left,
  .roller .right,
  .roller .sep {
    color: var(--muted);
    font-weight: 600;
  }

  .number {
    display: inline-flex;
    align-items: baseline;
    gap: 0;
  }

  .integer, .fraction {
    display: inline-flex;
    gap: 0;
  }

  .digit {
    position: relative;
    width: var(--digit-width);
    height: var(--digit-height);
    overflow: hidden;
    display: inline-block;
    text-align: center;
  }

  .reel {
    position: absolute;
    left: 0;
    top: 0;
    transition: transform var(--duration) var(--easing);
    will-change: transform;
  }

  .reel > span {
    display: block;
    width: var(--digit-width);
    height: var(--digit-height);
    line-height: var(--digit-height);
  }

  .sep {
    display: inline-block;
    padding: 0 .05em;
    transform: translateY(0.05em);
  }

  .note {
    font-size: 12px;
    color: var(--muted);
  }

  .row {
    display: flex;
    align-items: baseline;
    gap: 8px;
  }
</style>
</head>
<body>
  <div class="app">
    <div class="controls">
      <div class="field">
        <label for="from">Текущее значение</label>
        <input id="from" type="text" value="30,00 $/month" />
      </div>
      <div class="field">
        <label for="to">Новое значение</label>
        <input id="to" type="text" value="300,00 $/year" />
      </div>
      <button id="run">Анимировать</button>
    </div>

    <div class="card">
      <div class="label">Просмотр</div>
      <div class="row">
        <div id="roller" class="roller" aria-live="polite"></div>
      </div>
      <div class="note" style="margin-top:8px">
        Цифры прокручиваются циклически (0→9→0). Нецифровые символы меняются сразу.
      </div>
    </div>
  </div>

<script>
  const DIGITS = Array.from({ length: 10 }, (_, i) => String(i));

  function isDigit(ch) {
    return ch >= '0' && ch <= '9';
  }

  function pickNumberRun(str) {
    const m = str.match(/(\d[\d.,]*)/);
    if (!m) {
      return { left: str, num: '', right: '', sep: null, ints: '', fracs: '' };
    }
    const left = str.slice(0, m.index);
    const num = m[1];
    const right = str.slice(m.index + num.length);

    const lastDot = num.lastIndexOf('.');
    const lastComma = num.lastIndexOf(',');
    let sep = null;
    let intPart = num;
    let fracPart = '';
    if (lastDot > lastComma && lastDot !== -1) {
      sep = '.';
      intPart = num.slice(0, lastDot);
      fracPart = num.slice(lastDot + 1);
    } else if (lastComma > lastDot && lastComma !== -1) {
      sep = ',';
      intPart = num.slice(0, lastComma);
      fracPart = num.slice(lastComma + 1);
    }

    intPart = intPart.replace(/[.,](?=\d{3}(\D|$))/g, '');
    return { left, num, right, sep, ints: intPart, fracs: fracPart };
  }

  function padLeft(str, len, ch = '0') {
    return str.length >= len ? str : ch.repeat(len - str.length) + str;
  }
  function padRight(str, len, ch = '0') {
    return str.length >= len ? str : str + ch.repeat(len - str.length);
  }

  function createDigitColumn(digitChar) {
    const col = document.createElement('span');
    col.className = 'digit';
    const reel = document.createElement('span');
    reel.className = 'reel';
    for (const d of DIGITS) {
      const s = document.createElement('span');
      s.textContent = d;
      reel.appendChild(s);
    }
    col.appendChild(reel);
    const start = isDigit(digitChar) ? Number(digitChar) : 0;
    setReelInstant(reel, start);
    col.dataset.current = String(start);
    return col;
  }

  function setReelInstant(reel, index) {
    const rowH = getRowHeight(reel);
    reel.style.transition = 'none';
    reel.style.transform = `translateY(${-index * rowH}px)`;
    void reel.offsetHeight;
    reel.style.transition = '';
  }

  function animateReelTo(reel, fromDigit, toDigit) {
    const start = Number(fromDigit);
    const end = Number(toDigit);
    const needWrap = end < start;

    if (needWrap) {
      reel.textContent = '';
      for (let r = 0; r < 2; r++) {
        for (const d of DIGITS) {
          const s = document.createElement('span');
          s.textContent = d;
          reel.appendChild(s);
        }
      }
    } else {
      if (reel.children.length !== 10) {
        reel.textContent = '';
        for (const d of DIGITS) {
          const s = document.createElement('span');
          s.textContent = d;
          reel.appendChild(s);
        }
      }
    }

    const rowH = getRowHeight(reel);
    setReelInstant(reel, start);

    requestAnimationFrame(() => {
      const targetIndex = needWrap ? 10 + end : end;
      reel.style.transform = `translateY(${-targetIndex * rowH}px)`;
    });
  }

  function getRowHeight(reel) {
    const first = reel.firstElementChild;
    if (first) return first.getBoundingClientRect().height || parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--digit-height'));
    return parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--digit-height'));
  }

  function renderValue(container, valueStr) {
    container.textContent = '';
    const parsed = pickNumberRun(valueStr);

    const leftEl = document.createElement('span');
    leftEl.className = 'left';
    leftEl.textContent = parsed.left;

    const numberEl = document.createElement('span');
    numberEl.className = 'number';

    const intEl = document.createElement('span');
    intEl.className = 'integer';
    const intsClean = stripLeadingZerosInt(parsed.ints);
    for (const ch of intsClean) {
        intEl.appendChild(createDigitColumn(ch));
    }

    const sepEl = document.createElement('span');
    sepEl.className = 'sep';
    if (parsed.fracs.length > 0 && parsed.sep) sepEl.textContent = parsed.sep;

    const fracEl = document.createElement('span');
    fracEl.className = 'fraction';
    for (const ch of parsed.fracs) {
      fracEl.appendChild(createDigitColumn(ch));
    }

    numberEl.appendChild(intEl);
    if (parsed.fracs.length > 0 && parsed.sep) numberEl.appendChild(sepEl);
    numberEl.appendChild(fracEl);

    const rightEl = document.createElement('span');
    rightEl.className = 'right';
    rightEl.textContent = ' ' + parsed.right;

    container.appendChild(leftEl);
    container.appendChild(numberEl);
    container.appendChild(rightEl);

    container._state = parsed;
  }

  function syncDigitColumns(wrapperEl, desiredCount) {
    const existing = Array.from(wrapperEl.querySelectorAll('.digit'));
    const currentCount = existing.length;

    if (currentCount < desiredCount) {
      const toAdd = desiredCount - currentCount;
      const frag = document.createDocumentFragment();
      for (let i = 0; i < toAdd; i++) {
        frag.appendChild(createDigitColumn('0'));
      }
      // Добавляем слева для выравнивания по правому краю
      wrapperEl.insertBefore(frag, wrapperEl.firstChild);
    } else if (currentCount > desiredCount) {
      const toRemove = currentCount - desiredCount;
      for (let i = 0; i < toRemove; i++) {
        if (wrapperEl.firstElementChild) wrapperEl.removeChild(wrapperEl.firstElementChild);
      }
    }
  }

  function animateTo(container, nextStr) {
    const prev = container._state || pickNumberRun('');
    const next = pickNumberRun(nextStr);

    const sep = next.sep || prev.sep || ',';
    const maxFrac = Math.max(prev.fracs.length, next.fracs.length);
    const prevIntsRaw = stripLeadingZerosInt(prev.ints);
    const nextIntsRaw = stripLeadingZerosInt(next.ints);
    const maxInt = Math.max(prevIntsRaw.length, nextIntsRaw.length);
    
    //const prevInts = padLeft(prev.ints, maxInt, '0');
    //const nextInts = padLeft(next.ints, maxInt, '0');
    const prevFracs = padRight(prev.fracs, maxFrac, '0');
    const nextFracs = padRight(next.fracs, maxFrac, '0');

    const leftEl = container.querySelector('.left');
    const rightEl = container.querySelector('.right');
    if (leftEl) leftEl.textContent = next.left;
    if (rightEl) rightEl.textContent = ' ' + next.right;

    const numberEl = container.querySelector('.number');
    let sepEl = container.querySelector('.sep');
    if (maxFrac > 0) {
      if (!sepEl) {
        sepEl = document.createElement('span');
        sepEl.className = 'sep';
        const fracElPos = container.querySelector('.fraction');
        numberEl.insertBefore(sepEl, fracElPos);
      }
      sepEl.textContent = sep;
    } else if (sepEl) {
      sepEl.remove();
    }

    const intEl = container.querySelector('.integer');
    const fracEl = container.querySelector('.fraction');
    syncDigitColumns(intEl, maxInt);
    syncDigitColumns(fracEl, maxFrac);

    const intCols = Array.from(intEl.querySelectorAll('.digit'));
    const fracCols = Array.from(fracEl.querySelectorAll('.digit'));

    for (let i = 0; i < maxInt; i++) {
      const col = intCols[i];
      const reel = col.querySelector('.reel');
      const prevIndex = prevIntsRaw.length - maxInt + i;
      const nextIndex = nextIntsRaw.length - maxInt + i;
      const fromDigit = prevIndex >= 0
        ? prevIntsRaw[prevIndex]
        : (nextIndex >= 0 ? nextIntsRaw[nextIndex] : '0');
      const toDigit = nextIndex >= 0 ? nextIntsRaw[nextIndex] : fromDigit;
      animateReelTo(reel, fromDigit, toDigit);
      col.dataset.current = toDigit;
    }

    for (let i = 0; i < maxFrac; i++) {
      const col = fracCols[i];
      const reel = col.querySelector('.reel');
      const fromDigit = prevFracs[i] || '0';
      const toDigit = nextFracs[i] || '0';
      animateReelTo(reel, fromDigit, toDigit);
      col.dataset.current = toDigit;
    }

    container._state = next;
  }

  // Init
  const roller = document.getElementById('roller');
  const fromInput = document.getElementById('from');
  const toInput = document.getElementById('to');
  const runBtn = document.getElementById('run');

  renderValue(roller, fromInput.value);

  let showing = 'from';
  runBtn.addEventListener('click', () => {
    const target = showing === 'from' ? toInput.value : fromInput.value;
    animateTo(roller, target);
    showing = showing === 'from' ? 'to' : 'from';
  });

  // Обновляем предпросмотр при изменении поля "Текущее", если сейчас показано "Текущее"
  fromInput.addEventListener('change', () => {
    if (showing === 'from') renderValue(roller, fromInput.value);
  });

  function stripLeadingZerosInt(s) {
  if (s.length === 0) return s;
  if (/^0+$/.test(s)) return '0';
  return s.replace(/^0+(?=\d)/, '');
}
</script>
</body>
</html>
